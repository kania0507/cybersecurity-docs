# Lab: Source code disclosure via backup files

[link to lab](https://0af300d504b119958008c68600390095.web-security-academy.net/)

Now some theory ‚Äî you may skip to [the lab section below üß™](lab-source-code-disclosure-via-backup-files.md#get-back-to-lab-checking-robots.txt-file).

**Information disclosure** happens when a system reveals data that should be kept confidential. This can include:

* Source code
* Configuration files
* Credentials or API keys
* Internal system details
* User data
* Debug or error information

Attackers often use disclosed information as a **stepping stone** to more serious attacks.

### What is Code Disclosure?

**Code disclosure** is a specific type of information disclosure where **application source code or binaries** are exposed.

#### Why this is dangerous

When attackers can see your code, they can:

* Identify vulnerabilities (e.g., SQL injection, auth flaws)
* Reverse engineer business logic
* Find hardcoded secrets
* Bypass security controls
* Develop precise, targeted exploits

Security through obscurity is not a defense‚Äîbut **unintentional code exposure removes even basic resistance**.

***

### Common Examples

#### a. Error Messages

```
Warning: include(/var/www/app/config.php) failed
```

Reveals:

* File paths
* Technology stack
* File names attackers can probe

***

#### b. Public Repositories

* Accidentally pushing private code to GitHub
* Leaked `.env` files with secrets
* Old commits containing passwords

Even if deleted, **history may still contain secrets**.

***

#### c. Misconfigured Servers

* Directory listing enabled
* Backup files accessible (`.bak`, `.old`, `.zip`)
* `.git/` directory exposed

Example:

```
https://example.com/.git/config
```

***

#### d. Client-Side Code Exposure

* Sensitive logic in JavaScript
* API keys embedded in frontend code
* Feature flags revealing hidden endpoints

**Anything sent to the browser is public**, even if minified.

***

#### e. Debug / Verbose Modes

* Stack traces shown in production
* Debug endpoints left enabled
* Test credentials still active

### Information Commonly Leaked

| Type           | Example                          |
| -------------- | -------------------------------- |
| Credentials    | API keys, DB passwords           |
| Infrastructure | IPs, hostnames, ports            |
| Code logic     | Auth flows, rate-limit logic     |
| User data      | Emails, IDs, session tokens      |
| Dependencies   | Library versions with known CVEs |

### Impact and Risk

Information disclosure:

* **Lowers the cost of attack**
* Enables chaining vulnerabilities
* Increases attack success rate
* May violate laws (GDPR, HIPAA, PCI-DSS)

Even ‚Äúlow severity‚Äù leaks can become **critical when combined** with other issues.

### Prevention & Mitigation

#### Development Practices

* Never hardcode secrets
* Use environment variables
* Review commits before pushing
* Scan repos for secrets (e.g., pre-commit hooks)

#### Server & Deployment

* Disable directory listing
* Restrict access to config files
* Remove backups from web roots
* Turn off debug mode in production

#### Error Handling

* Show generic error messages to users
* Log detailed errors server-side only

#### Access Control

* Enforce least privilege
* Protect admin/debug endpoints
* Use authentication for internal tools

#### Monitoring & Testing

* Regular security audits
* Automated secret scanning
* Penetration testing
* Bug bounty programs

***

#### üß™ **Get back to lab:** checking /robots.txt file

```
User-agent: *
Disallow: /backup
```

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

File contents:<br>

```
package data.productcatalog;

import common.db.JdbcConnectionBuilder;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.Serializable;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

public class ProductTemplate implements Serializable
{
    static final long serialVersionUID = 1L;

    private final String id;
    private transient Product product;

    public ProductTemplate(String id)
    {
        this.id = id;
    }

    private void readObject(ObjectInputStream inputStream) throws IOException, ClassNotFoundException
    {
        inputStream.defaultReadObject();

        ConnectionBuilder connectionBuilder = ConnectionBuilder.from(
                "org.postgresql.Driver",
                "postgresql",
                "localhost",
                5432,
                "postgres",
                "postgres",
                "xlila04de2fg4stpowy6qqtrzucll3yw"
        ).withAutoCommit();
        try
        {
            Connection connect = connectionBuilder.connect(30);
            String sql = String.format("SELECT * FROM products WHERE id = '%s' LIMIT 1", id);
            Statement statement = connect.createStatement();
            ResultSet resultSet = statement.executeQuery(sql);
            if (!resultSet.next())
            {
                return;
            }
            product = Product.from(resultSet);
        }
        catch (SQLException e)
        {
            throw new IOException(e);
        }
    }

    public String getId()
    {
        return id;
    }

    public Product getProduct()
    {
        return product;
    }
}
```

**Conclusion:**\
We should not be able to see the contents of source code files, and especially not database access credentials or configuration settings.

The exposure of source code files and database access credentials constitutes a serious security risk. Such information should never be publicly accessible, as it may allow unauthorized parties to analyze the application logic, compromise the database, and gain further access to the system.
